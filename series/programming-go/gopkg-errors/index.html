<!doctype html><html lang=zh dir=auto>
<head>
<link rel=stylesheet href=/css/fi.css crossorigin=anonymous><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Go 包 - errors | 博客 · 丁鹏</title>
<meta name=keywords content="Golang,gopkg,errors">
<meta name=description content="errors 包为你的 Go 程序提供一种对程序员调试、查看日志更友好的错误处理方式。 Go 程序中传统的错误处理方法： if err != nil { return err } 递归的向上传递错误，这种方式">
<meta name=author content="丁鹏">
<link rel=canonical href=https://srcio.cn/series/programming-go/gopkg-errors/>
<meta name=baidu-site-verification content="code-yW1u8Rg4sz">
<meta name=google-site-verification content="qnXhMaPNdhaZ4A36ptMVUn-0o111dAsJqugH_0ZCYvM">
<link crossorigin=anonymous href=/assets/css/stylesheet.e885a03929d345922e032bc3e661c94c00cedb52c10d75afe2642bd4071375a8.css integrity="sha256-6IWgOSnTRZIuAyvD5mHJTADO21LBDXWv4mQr1AcTdag=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://srcio.cn/images/blog.png>
<link rel=icon type=image/png sizes=16x16 href=https://srcio.cn/images/blog.png>
<link rel=icon type=image/png sizes=32x32 href=https://srcio.cn/images/blog.png>
<link rel=apple-touch-icon href=https://srcio.cn/images/blog.png>
<link rel=mask-icon href=https://srcio.cn/images/blog.png>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Go 包 - errors">
<meta property="og:description" content="errors 包为你的 Go 程序提供一种对程序员调试、查看日志更友好的错误处理方式。 Go 程序中传统的错误处理方法： if err != nil { return err } 递归的向上传递错误，这种方式">
<meta property="og:type" content="article">
<meta property="og:url" content="https://srcio.cn/series/programming-go/gopkg-errors/"><meta property="og:image" content="https://srcio.cn/cover.png"><meta property="article:section" content="series">
<meta property="article:published_time" content="2022-10-19T14:44:06+08:00">
<meta property="article:modified_time" content="2022-11-03T03:32:31+00:00"><meta property="og:site_name" content="博客">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://srcio.cn/cover.png">
<meta name=twitter:title content="Go 包 - errors">
<meta name=twitter:description content="errors 包为你的 Go 程序提供一种对程序员调试、查看日志更友好的错误处理方式。 Go 程序中传统的错误处理方法： if err != nil { return err } 递归的向上传递错误，这种方式">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"系列","item":"https://srcio.cn/series/"},{"@type":"ListItem","position":2,"name":"Golang 编程","item":"https://srcio.cn/series/programming-go/"},{"@type":"ListItem","position":3,"name":"Go 包 - errors","item":"https://srcio.cn/series/programming-go/gopkg-errors/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Go 包 - errors","name":"Go 包 - errors","description":"errors 包为你的 Go 程序提供一种对程序员调试、查看日志更友好的错误处理方式。 Go 程序中传统的错误处理方法： if err != nil { return err } 递归的向上传递错误，这种方式","keywords":["Golang","gopkg","errors"],"articleBody":"errors 包为你的 Go 程序提供一种对程序员调试、查看日志更友好的错误处理方式。\nGo 程序中传统的错误处理方法：\nif err != nil { return err } 递归的向上传递错误，这种方式有一个缺陷：最终处理错误的位置无法获取错误的调用上下文信息。\nerrors 包以不破坏错误的原始值的方式向错误中的添加调用上下文信息。\n获取包 go get github.com/pkg/errors 错误添加上下文 The errors.Wrap function returns a new error that adds context to the original error. For example\n_, err := ioutil.ReadAll(r) if err != nil { return errors.Wrap(err, \"read failed\") } Retrieving the cause of an error Using errors.Wrap constructs a stack of errors, adding context to the preceding error. Depending on the nature of the error it may be necessary to reverse the operation of errors.Wrap to retrieve the original error for inspection. Any error value which implements this interface can be inspected by errors.Cause.\ntype causer interface { Cause() error } errors.Cause will recursively retrieve the topmost error which does not implement causer, which is assumed to be the original cause. For example:\nswitch err := errors.Cause(err).(type) { case *MyError: // handle specifically default: // unknown error } Read the package documentation for more information.\nRoadmap With the upcoming Go2 error proposals this package is moving into maintenance mode. The roadmap for a 1.0 release is as follows:\n 0.9. Remove pre Go 1.9 and Go 1.10 support, address outstanding pull requests (if possible) 1.0. Final release.  Contributing Because of the Go2 errors changes, this package is not accepting proposals for new functionality. With that said, we welcome pull requests, bug fixes and issue reports.\nBefore sending a PR, please discuss your change by raising an issue.\nLicense BSD-2-Clause\n","wordCount":"362","inLanguage":"zh","datePublished":"2022-10-19T14:44:06+08:00","dateModified":"2022-11-03T03:32:31.646Z","author":[{"@type":"Person","name":"丁鹏"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://srcio.cn/series/programming-go/gopkg-errors/"},"publisher":{"@type":"Organization","name":"博客 · 丁鹏","logo":{"@type":"ImageObject","url":"https://srcio.cn/images/blog.png"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://srcio.cn/ accesskey=h title="博客 (Alt + H)">
<img src=https://srcio.cn/images/blog.png alt aria-label=logo height=25>博客</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://srcio.cn/posts/ title=文章>
<span>
<i class="fi fi-book"></i>&nbsp;文章</span>
</a>
</li>
<li>
<a href=https://srcio.cn/series/ title=系列>
<span class=active>
<i class="fi fi-series"></i>&nbsp;系列</span>
</a>
</li>
<li>
<a href=https://srcio.cn/tags/ title=标签>
<span>
<i class="fi fi-tags"></i>&nbsp;标签</span>
</a>
</li>
<li>
<a href=https://srcio.cn/archives/ title=归档>
<span>
<i class="fi fi-folder"></i>&nbsp;归档</span>
</a>
</li>
<li>
<a href=/search title="Alt + /" accesskey=/>
<span>
<i class="fi fi-search"></i>
</span>
</a>
</li>
<li>
<span>|</span>
</li>
<li>
<span>
<a href=https://github.com/srcio target=_blank rel="noopener noreferrer me">
<i class="fi fi-github"></i>
</a>
<span>·</span>
<a href=mailto:me@srcio.cn target=_blank rel="noopener noreferrer me">
<i class="fi fi-mail"></i>
</a>
</span>
</li>
</ul>
</nav>
</header><main class=main>
<article class=post-single>
<div class=post-left-article>
<header class=post-header>
<div class=breadcrumbs><p>
<span><a href=/><i class="fi fi-home"></i>&nbsp;主页</a></span><span><i class="fi fi-angle-right"></i><a href=https://srcio.cn/series/>系列</a></span><span><i class="fi fi-angle-right"></i><a href=https://srcio.cn/series/programming-go/>Golang 编程</a></span><i class="fi fi-angle-right"></i><span>Go 包 - errors</span>
</p>
</div>
<h1 id=post-title class=post-title>
Go 包 - errors
</h1>
<div class=post-meta><span class=meta-item>
<span>
<i class="fi fi-calendar"></i>2022-10-19
</span>
</span><span class=meta-item>
<span>
&nbsp;·&nbsp;<i class="fi fi-clock"></i>1 分钟</span>
</span><span class=meta-item>
<span>
&nbsp;·&nbsp;<i class="fi fi-word"></i>362 字</span>
</span>
<span class=meta-item>
<span>
&nbsp;·&nbsp;<i class="fi fi-user"></i>丁鹏
</span>
</span><span class=meta-item>
&nbsp;·&nbsp;<i class="fi fi-eye"></i>&nbsp;<span id=busuanzi_value_page_pv></span>
</span>&nbsp;|&nbsp;<a href=https://github.com/srcio/blog/edit/master/content/series/programming-go/gopkg-errors.md rel="noopener noreferrer" target=_blank>
<i class="fi fi-edit"></i>&nbsp;编辑</a>
</div>
</header>
<div class=post-content><p><code>errors</code> 包为你的 Go 程序提供一种对程序员调试、查看日志更友好的错误处理方式。</p>
<p>Go 程序中传统的错误处理方法：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>err</span>
<span class=p>}</span>
</code></pre></div><p>递归的向上传递错误，这种方式有一个缺陷：最终处理错误的位置无法获取错误的调用上下文信息。</p>
<p><code>errors</code> 包以不破坏错误的原始值的方式向错误中的添加调用上下文信息。</p>
<h2 id=获取包>获取包<a hidden class=anchor aria-hidden=true href=#获取包>#</a></h2>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=k>go</span> <span class=nx>get</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>pkg</span><span class=o>/</span><span class=nx>errors</span>
</code></pre></div><h2 id=错误添加上下文>错误添加上下文<a hidden class=anchor aria-hidden=true href=#错误添加上下文>#</a></h2>
<p>The errors.Wrap function returns a new error that adds context to the original error. For example</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ioutil</span><span class=p>.</span><span class=nf>ReadAll</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
    <span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;read failed&#34;</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><h2 id=retrieving-the-cause-of-an-error>Retrieving the cause of an error<a hidden class=anchor aria-hidden=true href=#retrieving-the-cause-of-an-error>#</a></h2>
<p>Using <code>errors.Wrap</code> constructs a stack of errors, adding context to the preceding error. Depending on the nature of the error it may be necessary to reverse the operation of errors.Wrap to retrieve the original error for inspection. Any error value which implements this interface can be inspected by <code>errors.Cause</code>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=kd>type</span> <span class=nx>causer</span> <span class=kd>interface</span> <span class=p>{</span>
    <span class=nf>Cause</span><span class=p>()</span> <span class=kt>error</span>
<span class=p>}</span>
</code></pre></div><p><code>errors.Cause</code> will recursively retrieve the topmost error which does not implement <code>causer</code>, which is assumed to be the original cause. For example:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=k>switch</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Cause</span><span class=p>(</span><span class=nx>err</span><span class=p>).(</span><span class=kd>type</span><span class=p>)</span> <span class=p>{</span>
<span class=k>case</span> <span class=o>*</span><span class=nx>MyError</span><span class=p>:</span>
    <span class=c1>// handle specifically
</span><span class=c1></span><span class=k>default</span><span class=p>:</span>
    <span class=c1>// unknown error
</span><span class=c1></span><span class=p>}</span>
</code></pre></div><p><a href=https://godoc.org/github.com/pkg/errors>Read the package documentation for more information</a>.</p>
<h2 id=roadmap>Roadmap<a hidden class=anchor aria-hidden=true href=#roadmap>#</a></h2>
<p>With the upcoming <a href=https://go.googlesource.com/proposal/+/master/design/go2draft.md>Go2 error proposals</a> this package is moving into maintenance mode. The roadmap for a 1.0 release is as follows:</p>
<ul>
<li>0.9. Remove pre Go 1.9 and Go 1.10 support, address outstanding pull requests (if possible)</li>
<li>1.0. Final release.</li>
</ul>
<h2 id=contributing>Contributing<a hidden class=anchor aria-hidden=true href=#contributing>#</a></h2>
<p>Because of the Go2 errors changes, this package is not accepting proposals for new functionality. With that said, we welcome pull requests, bug fixes and issue reports.</p>
<p>Before sending a PR, please discuss your change by raising an issue.</p>
<h2 id=license>License<a hidden class=anchor aria-hidden=true href=#license>#</a></h2>
<p>BSD-2-Clause</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://srcio.cn/tags/golang/><i class="fi fi-tag"></i>&nbsp;Golang</a></li>
<li><a href=https://srcio.cn/tags/gopkg/><i class="fi fi-tag"></i>&nbsp;gopkg</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://srcio.cn/series/programming-go/golang-%E7%A8%8B%E5%BA%8F-solid-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/>
<strong class=title><i class="fi fi-backward"></i>&nbsp;上一页</strong>
<br>Golang 程序 SOLID 设计原则</a>
<a class=next href=https://srcio.cn/series/programming-go/%E6%95%B0%E7%BB%84%E9%80%92%E5%BD%92%E6%9E%84%E9%80%A0%E5%85%B7%E6%9C%89%E7%88%B6%E5%AD%90%E5%B1%82%E7%BA%A7%E5%85%B3%E7%B3%BB%E7%9A%84%E5%AF%B9%E8%B1%A1/>
<strong class=title>下一页&nbsp;<i class="fi fi-forward"></i></strong>
<br>数组递归构造具有父子层级关系的对象</a>
</nav>
</footer>
<div class=giscus_comments><script src=https://giscus.app/client.js data-repo=srcio/blog data-repo-id=R_kgDOIFWX7A data-category=General data-category-id=DIC_kwDOIFWX7M4CRrSg data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=zh-CN crossorigin=anonymous async></script>
</div>
<script>document.querySelector("div.giscus_comments > script").setAttribute("data-theme",localStorage.getItem("pref-theme")?localStorage.getItem("pref-theme"):window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.querySelector("#theme-toggle").addEventListener("click",()=>{let a=document.querySelector("iframe.giscus-frame");a&&a.contentWindow.postMessage({giscus:{setConfig:{theme:localStorage.getItem("pref-theme")?localStorage.getItem("pref-theme")==="dark"?"light":"dark":document.body.className.includes("dark")?"light":"dark"}}},"https://giscus.app")})</script>
</div>
<div class=post-right-toc><div class=toc>
<div open>
<div class=inner><ul>
<li>
<a href=#%e8%8e%b7%e5%8f%96%e5%8c%85 aria-label=获取包>获取包</a></li>
<li>
<a href=#%e9%94%99%e8%af%af%e6%b7%bb%e5%8a%a0%e4%b8%8a%e4%b8%8b%e6%96%87 aria-label=错误添加上下文>错误添加上下文</a></li>
<li>
<a href=#retrieving-the-cause-of-an-error aria-label="Retrieving the cause of an error">Retrieving the cause of an error</a></li>
<li>
<a href=#roadmap aria-label=Roadmap>Roadmap</a></li>
<li>
<a href=#contributing aria-label=Contributing>Contributing</a></li>
<li>
<a href=#license aria-label=License>License</a>
</li>
</ul>
</div>
</div>
</div>
<script>let activeElement,elements;window.addEventListener('DOMContentLoaded',function(b){elements=document.querySelectorAll('h1[id],h2[id],h3[id],h4[id]'),activeElement=elements[0];const a=encodeURI(activeElement.getAttribute('id')).toLowerCase();document.querySelector(`.inner ul li a[href="#${a}"]`).classList.add('active')},!1),window.addEventListener('scroll',()=>{activeElement=Array.from(elements).find(a=>{if(getOffsetTop(a)-window.pageYOffset>0&&getOffsetTop(a)-window.pageYOffset<window.innerHeight/2)return a})||activeElement,elements.forEach(a=>{const b=encodeURI(a.getAttribute('id')).toLowerCase();a===activeElement?document.querySelector(`.inner ul li a[href="#${b}"]`)?.classList.add('active'):document.querySelector(`.inner ul li a[href="#${b}"]`)?.classList.remove('active')})},!1);function getOffsetTop(a){if(!a.getClientRects().length)return 0;let b=a.getBoundingClientRect(),c=a.ownerDocument.defaultView;return b.top+c.pageYOffset}</script>
</div>
<div class=clear_float></div>
</article>
</main>
<script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<footer class=footer>
<p>
<span>
<i class="fi fi-copyright"></i>2023
<a href=https://srcio.cn/>博客 · 丁鹏</a>
</span>
&nbsp;|&nbsp;
<span>
<a href=https://beian.miit.gov.cn/><i class="fi fi-shield"></i>湘ICP备2022019990号</a>
</span>
</p>
<p>
<span>
<i class="fi fi-fire"></i>本站共计
<a id=busuanzi_value_site_pv>0</a> 次访问 & <a id=busuanzi_value_site_uv>0</a> 位访客
</span>
</p>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='<i class="fi fi-copy"></i>';function d(){a.innerHTML='<i class="fi fi-check"></i>',setTimeout(()=>{a.innerHTML='<i class="fi fi-copy"></i>'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body>
</html>