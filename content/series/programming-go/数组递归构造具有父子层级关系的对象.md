---
title: æ•°ç»„é€’å½’æ„é€ å…·æœ‰çˆ¶å­å±‚çº§å…³ç³»çš„å¯¹è±¡
date: 2022-10-18T18:00:26+08:00
draft: false
tags:
  - Golang
keywords:
  - æ•°ç»„
  - é€’å½’
  - çˆ¶å­
  - æ ‘
  - å±‚çº§å…³ç³»
weight: 1
lastmod: 2022-11-21T10:09:54.522Z
---

## åœºæ™¯ä»‹ç»

ä»æ•°æ®åº“è·å–åˆ°äº†èœå•åˆ—è¡¨æ•°æ®ï¼Œè¿™äº›èœå•æ•°æ®é€šè¿‡å­—æ®µ ParentID è¡¨ç¤ºçˆ¶å­å±‚çº§å…³ç³»ï¼Œç°åœ¨éœ€è¦å°†èœå•åˆ—è¡¨æ•°æ®è½¬æˆæ ‘çŠ¶çš„å®ä¾‹å¯¹è±¡ã€‚

æ•°æ®åº“å–å‡ºçš„åˆå§‹æ•°æ®ï¼š

```go
raw := []Menu{
	{Name: "ä¸€çº§èœå• 1", ID: 1, PID: 0},
	{Name: "ä¸€çº§èœå• 2", ID: 2, PID: 0},
	{Name: "ä¸€çº§èœå• 3", ID: 3, PID: 0},
	{Name: "äºŒçº§èœå• 1-1", ID: 11, PID: 1},
	{Name: "äºŒçº§èœå• 1-2", ID: 12, PID: 1},
	{Name: "äºŒçº§èœå• 1-3", ID: 13, PID: 1},
	{Name: "äºŒçº§èœå• 2-1", ID: 21, PID: 2},
	{Name: "äºŒçº§èœå• 2-2", ID: 22, PID: 2},
	{Name: "äºŒçº§èœå• 2-3", ID: 23, PID: 2},
}
```

éœ€è¦å¾—åˆ°çš„ç›®æ ‡æ•°æ®ï¼š

```json
{
    "name":"æ ¹èœå•",
    "id":0,
    "pid":0,
    "SubMenus":[
        {
            "name":"ä¸€çº§èœå• 1",
            "id":1,
            "pid":0,
            "SubMenus":[
                {
                    "name":"äºŒçº§èœå• 1-1",
                    "id":11,
                    "pid":1
                },
                {
                    "name":"äºŒçº§èœå• 1-2",
                    "id":12,
                    "pid":1
                },
                {
                    "name":"äºŒçº§èœå• 1-3",
                    "id":13,
                    "pid":1
                }
            ]
        },
        {
            "name":"ä¸€çº§èœå• 2",
            "id":2,
            "pid":0,
            "SubMenus":[
                {
                    "name":"äºŒçº§èœå• 2-1",
                    "id":21,
                    "pid":2
                },
                {
                    "name":"äºŒçº§èœå• 2-2",
                    "id":22,
                    "pid":2
                },
                {
                    "name":"äºŒçº§èœå• 2-3",
                    "id":23,
                    "pid":2
                }
            ]
        },
        {
            "name":"ä¸€çº§èœå• 3",
            "id":3,
            "pid":0
        }
    ]
}
```

## ä»£ç å®ç°

```go
package main

import (
	"encoding/json"
	"fmt"
)

func main() {
	// æ•°æ®åº“é‡Œå­˜å‚¨çš„èœå•
	rawMenus := []Menu{
		{Name: "ä¸€çº§èœå• 1", ID: 1, PID: 0},
		{Name: "ä¸€çº§èœå• 2", ID: 2, PID: 0},
		{Name: "ä¸€çº§èœå• 3", ID: 3, PID: 0},
		{Name: "äºŒçº§èœå• 1-1", ID: 11, PID: 1},
		{Name: "äºŒçº§èœå• 1-2", ID: 12, PID: 1},
		{Name: "äºŒçº§èœå• 1-3", ID: 13, PID: 1},
		{Name: "äºŒçº§èœå• 2-1", ID: 21, PID: 2},
		{Name: "äºŒçº§èœå• 2-2", ID: 22, PID: 2},
		{Name: "äºŒçº§èœå• 2-3", ID: 23, PID: 2},
	}
	menu := &Menu{
		Name: "æ ¹èœå•",
		PID:  0,
	}

	for _, rm := range rawMenus {
		menu.setSubMenus(rm)
	}

	// æ‰“å°ç»“æœ
	b, _ := json.Marshal(menu)
	fmt.Println(string(b))
}

type Menu struct {
	Name     string `json:"name"`
	ID       int    `json:"id"`
	PID      int    `json:"pid"`
	SubMenus []Menu `json:",omitempty"`
}

func (m *Menu) setSubMenus(menu Menu) bool {
	if menu.PID == m.ID {
		m.SubMenus = append(m.SubMenus, menu)
		return true
	}
	for i := range m.SubMenus {
		if m.SubMenus[i].setSubMenus(menu) {
			return true
		}
	}
	return false
}
```

## æ³¨æ„äº‹é¡¹

Golang for éå†ä½¿ç”¨ `for _, item := range slice` æ—¶ï¼Œ`item` æ˜¯ä¸€ä»½éå†å…ƒç´ çš„å¤åˆ¶ï¼Œè€Œä½¿ç”¨ `for i := range slice` æ—¶ï¼Œ`slice[i]` åˆ™æ˜¯éå†å…ƒç´ æœ¬èº«ï¼Œä½¿ç”¨æ—¶éœ€è¦æ³¨æ„åˆ‡ç‰‡æ‰©å®¹å¸¦æ¥çš„åœ°å€å˜åŒ–é—®é¢˜ã€‚

å¯ä»¥å‚è€ƒè¿™ç¯‡æ¥ç†è§£ï¼šğŸ‘‰ğŸ»[Golang åˆ‡ç‰‡æ‰©å®¹](../slice-append)